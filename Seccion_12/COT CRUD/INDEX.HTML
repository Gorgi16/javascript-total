<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>CRUD con JSON Server</title>
    <link rel="stylesheet" href="misEstilos.css" />
    <script src="misScripts.js" defer></script>
</head>
<body>
    <h2>Gestión de productos</h2>
    <br>
    <input type="number" id="ID" placeholder="ID" />
    <input type="text" id="NOMBRE" placeholder="NOMBRE" />
    <input type="number" id="PRECIO" placeholder="PRECIO" />
    <input type="text" id="ACCIONES" placeholder="ACCIONES" />
    <br><br>
    <button onclick="agregarProducto()">Agregar Producto</button>
    <button onclick="actualizarPost()">Actualizar POST</button>

    <h3>Lista de Productos</h3>
    <table id="Tabla">
        <thead>
            <tr>
                <th>ID</th>
                <th>NOMBRE</th>
                <th>PRECIO</th>
                <th>ACCIONES</th>
            </tr>
        </thead>
        <body id="bodyProductos"></body>
    </table>

    <script>
        const API_URL = 'https://api.restful-api.dev/objets';

        function cargarProductos() {
            fetch(API_URL)
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('tbodyProductos');
                    tbody.innerHTML = '';
                    data.forEach(producto => {
                        const fila = document.createElement('tr');

                        fila.innerHTML = `
                            <td>${producto.id}</td>
                            <td>${producto.NOMBRE}</td>
                            <td>${producto.PRECIO}</td>
                            <td>
                                <button onclick="editarProducto(${producto.id})">Editar</button>
                                <button onclick="eliminarProducto(${producto.id})">Eliminar</button>
                            </td>
                        `;
                        tbody.appendChild(fila);
                    });
                })
                .catch(error => console.error('Error al cargar productos:', error));
        }
        function agregarProducto() {
            const NOMBRE = document.getElementById('NOMBRE').value.trim();
            const PRECIO = parseFloat(document.getElementById('PRECIO').value);
            if (!NOMBRE || isNaN(PRECIO)) {
                alert('Por favor, ingrese un nombre y un precio válido.');
                return;
            }

            fetch(API_URL(`https://api.restful-api.dev/objets`), {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ NOMBRE, PRECIO }),
            })
            .then(res => res.json())
            .then(() => {
                document.getElementById('NOMBRE').value = 'NOMBRE';
                document.getElementById('PRECIO').value = 'PRECIO';
                cargarProductos();
            })
            .catch(error => console.error('Error al agregar producto:', error));
        }

       
        function eliminarProducto(id) {
            if (!confirm('¿Estás seguro de eliminar este producto?')) return;

            fetch(`${API_URL}/${id}`, {
                method: 'DELETE',
            })
            .then(() => cargarProductos())
            .catch(error => console.error('Error al eliminar producto:', error));
        }

        
        function editarProducto(id) {
            fetch(`${API_URL}/${id}`)
                .then(res => res.json())
                .then(producto => {
                    document.getElementById('ID').value = producto.id;
                    document.getElementById('NOMBRE').value = producto.NOMBRE;
                    document.getElementById('PRECIO').value = producto.PRECIO;
                })
                .catch(error => console.error('Error al obtener producto:', error));
        }

       
        function actualizarPost() {
            const id = document.getElementById('ID').value;
            const NOMBRE = document.getElementById('NOMBRE').value.trim();
            const PRECIO = parseFloat(document.getElementById('PRECIO').value);

            if (!id || !NOMBRE || isNaN(PRECIO)) {
                alert('Por favor, complete todos los campos con valores válidos.');
                return;
            }

            fetch(`${API_URL}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ NOMBRE, PRECIO }),
            })
            .then(res => res.json())
            .then(() => {
            
                document.getElementById('ID').value = '';
                document.getElementById('NOMBRE').value = '';
                document.getElementById('PRECIO').value = '';
                cargarProductos();
            })
            .catch(error => console.error('Error al actualizar producto:', error));
        }

        window.onload = cargarProductos;
    </script>
</body>
</html>